function GetContent(n){let t=$("#StartDate").val(),i=$("#EndDate").val(),r=$("#TopicFilter").val();$.get("/Requests/GetArchivedRequests",{startDate:t,endDate:i,topicContains:r,page:n},function(n){if(n.isFaulted){let t={};t.responseText=JSON.stringify(n);DisplayMessages(t)}else SetPaginationData(n.jsonData),PopulateRequestsTable(n.jsonData),CreatePagination()})}function SetPaginationData(n){amountOfPages=n.pagination.amountOfPages;currentPage=n.pagination.currentPage;pageSize=n.pagination.pageSize;pageRecordsAmount=n.requests.length}function PopulateRequestsTable(n){EraseTableContent();n.requests.length>0?AddRequestsToTable(n.requests):AddNoResultsToTable()}function EraseTableContent(){$("#Requests").empty()}function AddNoResultsToTable(){$("#Requests").append('<tr><td class="align-middle text-center" colspan="7">No data to display<\/td><\/tr>')}function AddRequestsToTable(n){for(var t=0;t<n.length;t++)AddSingleRequestToTable(n[t],t+1)}function AddSingleRequestToTable(n,t){$("#Requests").append('<tr><td class="align-middle">'+GetRecordNumber(t)+'<\/td><td class="align-middle">'+n.request.userName+'<\/td><td class="align-middle">'+n.request.creationTime.substring(0,19).replace("T"," ")+'<\/td><td class="align-middle">'+n.request.topic+"<\/td>"+CreateResponsesAmount(n)+'<td class="align-middle">'+BoolToYN(n.request.privateRequest)+"<\/td>"+CreateChangeStateButton(n)+"<\/tr>")}function GetRecordNumber(n){return(currentPage-1)*pageSize+n}function CreateResponsesAmount(n){return'<td class="align-middle"><button type="button" class="btn badge badge-sm badge-primary text-white" onclick="ShowResponses(\''+n.request.identity+"')\">"+n.request.repliesAmount+" (show conversation)<\/button><\/td>"}function CreateChangeStateButton(n){return'<td class="align-middle"><button type="button" class="btn badge badge-sm badge-warning text-white" onclick="ChangeRequestState(\''+n.request.identity+"', '"+n.request.caseClosed+"')\">Change state<\/button><\/td>"}function BoolToYN(n){return n==!0?"Yes":"No"}function ChangePage(n){GetContent(n)}function ShowResponses(n){$.get("/Requests/GetResponses",{requestId:n},function(n){if(n.isFaulted){let t={};t.responseText=JSON.stringify(n);DisplayMessages(t)}else ResponsesModal(n.jsonData)})}function ResponsesModal(n){let t=n;$("#ConvTimeSpan").text(n.request.creationTime.substring(0,19).replace("T"," "));$("#ConvUserName").text(n.request.userName);$("#ConvMessage").text(n.request.message);EraseModalRepliesContent();PopulateRepliesModalWithReplies(n);$("#ConversationModal").modal("show")}function EraseModalRepliesContent(){$("#ModalResponses").empty()}function PopulateRepliesModalWithReplies(n){if(n.responses.length>0){$("#ModalResponses").append('<label class="mt-2">Replies: <\/label>');for(var t=0;t<n.responses.length;t++)AddSingleResponseToModal(n.responses[t])}}function AddSingleResponseToModal(n){$("#ModalResponses").append('<div class="bg-message rounded p-2 my-1"><div><span>'+n.userName+"<\/span> on <span>"+n.responseTime.substring(0,19).replace("T"," ")+"<\/span> replied: <\/span><div><span>"+n.message+"<\/span><\/div><\/div>")}function ChangeRequestState(n,t){idOfRequestForStateChange=n;$("#CurrentRequestState").text(GetStatus(t));$('input[name="state"]').prop("checked",!1);$("#ChangeStateModal").modal("show")}$(document).ready(function(){GetContent(1)});$("#ConfirmStateChange").click(function(){if($("input[name='state']:checked").val()){let n=$("#NewStateClosed").is(":checked"),t=idOfRequestForStateChange;idOfRequestForStateChange=0;$("#ChangeStateModal").modal("hide");$.post("/Requests/ChangeRequestStatus",{requestId:t,closed:n},function(n){if(n.isFaulted){let t={};t.responseText=JSON.stringify(n);DisplayMessages(t)}else{let n=currentPage;pageRecordsAmount==1&&currentPage>1&&n--;GetContent(n);RefreshRequestsSidebar()}})}});