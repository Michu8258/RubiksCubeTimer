function GetScrambleFormatted(n){let t=[];if(n){let u=n.split(" "),f=1,r="";for(var i=0;i<u.length;i++){if(r+=u[i],f==10?(t.push(r),r="",f=0):r+=" ",i==u.length){t.push(r);break}f++}return t}return t.push("No scramble"),t}function GetSeriesData(n){let t=$("#UserId").val(),i=$("#SeriesAmount").val(),r=$("#StartDate").val(),u=$("#EndDate").val(),f=$("#CategoryId").val(),e=$("#CubeId").val(),o=$("#CategoryOptionId").val();$.get("/Series/GetSeriesData",{id:t,limit:i,startDate:r,endDate:u,categoryId:f,cubeId:e,categoryOptionId:o,page:n},function(n){ResponseCheck(n,HandleSeriesResponse)})}function HandleSeriesResponse(n){amountOfPages=n.pagination.amountOfPages;currentPage=n.pagination.currentPage;pageSize=n.pagination.pageSize;pageRecordsAmount=n.serieData.length;PopulateSeriesTable(n.serieData)}function PopulateSeriesTable(n){if($("#SeriesCollection").empty(),n.length<1)AddNoResultsRow();else for(var t=0;t<n.length;t++)AddSingleSerieDataToTable(n[t],t+1);CreatePagination()}function AddNoResultsRow(){$("#SeriesCollection").append('<tr><td class="align-middle text-center" colspan="'+$("#Columns").val()+'">No data to display<\/td><\/tr>')}function AddSingleSerieDataToTable(n,t){var i=$("#Columns").val();$("#SeriesCollection").append('<tr><td class="align-middle"><button class="btn badge badge-primary" title="Download series report" onclick="SerieReport(\''+n.identity+"')\">"+GetRecordNumber(t)+'<\/button><\/td > <td class="align-middle">'+n.startTimeStamp.substring(0,19).replace("T"," ")+'<\/td><td class="align-middle">'+n.cube.category.name+'<\/td><td class="align-middle">'+n.cube.manufacturer.name+" "+n.cube.modelName+" "+n.cube.plasticColor.name+'<\/td><td class="align-middle">'+GetTimefromMiliseconds(n.shortestResult.totalMilliseconds)+'<\/td><td class="align-middle">'+GetTimefromMiliseconds(n.longestResult.totalMilliseconds)+'<\/td><td class="align-middle">'+GetTimefromMiliseconds(n.averageTime.totalMilliseconds)+'<\/td><td class="align-middle">'+GetTimefromMiliseconds(n.meanOf3.totalMilliseconds)+'<\/td><td class="align-middle">'+GetTimefromMiliseconds(n.averageOf5.totalMilliseconds)+'<\/td><td class="align-middle">'+BoolToYN(n.atLeastOneDNF)+'<\/td><td class="align-middle"><button class="btn badge badge-dark text-white" onclick="ShowDetailsChart(\''+n.identity+"')\">"+n.solvesAmount+" solve(s)<\/button><\/td>"+GetAdminOption(i,n)+"<\/tr>")}function GetRecordNumber(n){return(currentPage-1)*pageSize+n}function BoolToYN(n){return n==!0?"Yes":"No"}function ChangePage(n){GetSeriesData(n)}function ShowDetailsChart(n){let t=$("#UserId").val();$.get("/Series/GetSerieChartData",{id:t,serieId:n},function(n){ResponseCheck(n,HandleSolvesTrendData)})}function HandleSolvesTrendData(n){if(currentSerie=n.serie,currentChartData=n.solves,$("#TrendHeader").text(currentSerie.cube.manufacturer.name+" "+currentSerie.cube.modelName+" "+currentSerie.cube.plasticColor.name),RemoveChartData(),n.solves.length>0){for(var t=0;t<n.solves.length;t++)chartData.labels.push(chartData.datasets[0].data.length+1),chartData.datasets[0].data.push(Math.trunc(n.solves[t].duration.totalMilliseconds)/1e3);TakeCareOfTimeUnit();$("#ChartModal").modal("show")}}function GetAdminOption(n,t){if(n>11)return InsertAdminButtons(t)}function SerieReport(n){$.get("/Series/GetSerieReport/",{serieId:n},function(t){saveData(t,"RubiksCubeOnlineTimer"+n+".txt")})}function saveData(n,t){var i=document.createElement("a");document.body.appendChild(i);i.style="display: none";var f=JSON.stringify(n),u=new Blob([n],{type:"text/plain;charset=utf-8"}),r=window.URL.createObjectURL(u);i.href=r;i.download=t;i.click();window.URL.revokeObjectURL(r)}let currentChartData=[],currentSerie={};$(document).ready(function(){GetSeriesData(1);let n={enabled:!0,displayColors:!1,titleFontSize:14,bodyFontSize:14,titleAlign:"center",callbacks:{label:function(n){var r=currentChartData[n.index],i,u;let t=[];if(t.push("Duration: "+GetTimefromMiliseconds(r.duration.totalMilliseconds)),t.push("Time stamp "+r.finishTimeSpan.substring(0,19).replace("T"," ")),t.push("Was DNF: "+BoolToYN(r.dnf)),t.push("Penalty (2s): "+BoolToYN(r.penaltyTwoSeconds)),t.push("Category: "+currentSerie.cube.category.name),t.push("Cube: "+currentSerie.cube.manufacturer.name+" "+currentSerie.cube.modelName+" "+currentSerie.cube.plasticColor.name),t.push("Category option: "+currentSerie.serieOption.name),i=GetScrambleFormatted(r.scramble),i.length==1&&t.push("Scramble: "+i[0]),i.length>1)for(t.push("Scramble:"),u=0;u<i.length;u++)t.push(i[u]);return t}}};InitializeCartesianChart(document.getElementById("SolvesChart").getContext("2d"),"bar",n)});$("#UpdateButton").click(function(){GetSeriesData(1)});