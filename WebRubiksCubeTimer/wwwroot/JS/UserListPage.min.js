function GetUserRolesData(n,t){ReadUserRoles(n,t)}function ReadUserRoles(n,t){$.ajax({url:"/RolesAdmin/GetUserRolesUserInfo",type:"GET",data:"id="+n,error:function(){alert("Error while trying to read "+t+" role aissignmets.")},success:function(n){OpenRoleAssignmentModal(n,t)}})}function OpenRoleAssignmentModal(n,t){if(n.validUser){$("#RolesModalHeader").html("Change roles assignments of user "+t);$("#RolesModalBody").html("");for(var i=0;i<n.roles.length;i++){let t=$("<span>");t.append('<p class="paragraph-nomargin text-dark">'+n.roles[i].roleName+"<\/p>");n.roles[i].userBelongs?t.append('<input type="checkbox" id="RoleID_'+n.roles[i].roleName+'" checked>'):t.append('<input type="checkbox" id="RoleID_'+n.roles[i].roleName+'">');t.append("<\/span>");$("#RolesModalBody").append(t)}$("#RolesModalBody").append('<input type="hidden" id="RoleUserID" value="'+n.userId+'"/>');$("#ModifyRolesModal").modal("show")}}function SaveRoleAssignmentsChanges(){let n=CollectRolesData();$("#ModifyRolesModal").modal("hide");UpdateUserRoles(n)}function CollectRolesData(){let u=document.getElementById("RoleUserID").value,t=$("[id^=RoleID_]"),r=[];for(var n=0;n<t.length;n++){let u=t[n].id.substring(7),f=t[n].checked,i={};i.roleName=u;i.userBelongs=f;r.push(i)}let i={};return i.userID=u,i.roles=r,i}function UpdateUserRoles(n){$.ajax({url:"/RolesAdmin/UpdateUserRoles",contentType:"application/json",type:"POST",data:JSON.stringify(n),error:function(){alert("Error while trying to update user roles.")},complete:function(n){DisplayMessages(n)}})}function EditUser(n){document.location="/UserAdmin/EditUser?id="+n+"&returnUrl="+window.location.pathname}function DeleteUser(n){document.location="/UserAdmin/ConfirmUserDeletion?id="+n+"&returnUrl="+window.location.pathname}function PinUser(n,t){$.post("/UserAdmin/PinUser/",{id:n,userName:t},function(n){let t={};t.responseText=JSON.stringify(n);DisplayMessages(t);n.isFaulted==!1&&AssignPinnedUser()})}function ChangePage(n){GetUsersData(n)}function GetUsersData(n){let t=$("#FilterUserName").val(),i=$("#FilterEmail").val(),r=$("#FilterPhoneNumber").val(),u=$("input[name=RolesRadio]:checked").val();$.get("/UserAdmin/GetUsersData",{username:t,email:i,phoneNumber:r,role:u,page:n},function(n){ResponseCheck(n,HandleUsersData)})}function HandleUsersData(n){amountOfPages=n.pagination.amountOfPages;currentPage=n.pagination.currentPage;pageSize=n.pagination.pageSize;pageRecordsAmount=n.users.length;PopulateUsersTable(n.users)}function PopulateUsersTable(n){if($("#UsersCollection").empty(),n.length<1)AddNoResultsRow();else for(var t=0;t<n.length;t++)AddSingleUserRecordToTable(n[t],t+1);CreatePagination()}function AddNoResultsRow(){$("#UsersCollection").append('<tr><td class="align-middle text-center" colspan="10">No data to display<\/td><\/tr>')}function AddSingleUserRecordToTable(n,t){$("#UsersCollection").append('<tr><td class="align-middle">'+GetRecordNumber(t)+'<\/td><td class="align-middle"><button type="button" class="btn badge badge-primary" data-toggle="tooltip" title="User management options" onclick="PinUser(\''+n.id+"', '"+n.userName+"')\">"+n.id+'<\/button><\/td> <td class="align-middle">'+GetLastLoginStamp(n.lastLoginTimeSpan)+'<\/td><td class="align-middle">'+n.userName+'<\/td><td class="align-middle">'+n.email+'<\/td><td class="align-middle">'+PhoneNumber(n.phoneNumber)+'<\/td><td class="align-middle"><a class="btn btn-sm btn-danger text-white text-nowrap" onclick="DeleteUser(\''+n.id+'\')">Delete<\/a><\/td><td class="align-middle"><a class="btn btn-sm btn-secondary text-white text-nowrap" onclick="EditUser(\''+n.id+'\')">Edit<\/a><\/td><td class="align-middle"><a class="btn btn-sm btn-secondary text-white text-nowrap" onclick="GetUserRolesData(\''+n.id+"', '"+n.userName+'\')">Assign Roles<\/a><\/td><td class="align-middle"><a class="btn btn-sm btn-secondary text-white text-nowrap" onclick="OpenEmailModal(\''+n.id+"', '"+n.userName+"', '"+n.email+"')\">Send email<\/a><\/td><\/tr>")}function GetLastLoginStamp(n){return n.substring(0,4)<2e3?"Before year of 2000":n.substring(0,19).replace("T"," ")}function PhoneNumber(n){return n==null?"---------":n}function GetRecordNumber(n){return(currentPage-1)*pageSize+n}$(document).ready(function(){GetUsersData(1)});$("#FilterButton").click(function(){$("#FilteringModal").modal("show")});$("#UpdateFiltersButton").click(function(){$("#FilteringModal").modal("hide");GetUsersData(1)});$("#ResetFiltersButton").click(function(){$("#FilterUserName").val("");$("#FilterEmail").val("");$("#FilterPhoneNumber").val("");$("input[name=RolesRadio]").prop("checked",!1);$("#FilteringModal").modal("hide");GetUsersData(1)});